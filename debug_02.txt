orka run .\examples\routing_memory_writers.yml "127"
2025-07-20 14:31:02,367 - orka.orchestrator.base - INFO - Memory decay enabled: short_term=0.1h, long_term=0.2h, check_interval=30min
2025-07-20 14:31:02,367 - orka.utils.embedder - INFO - Using embedding dimension: 384
2025-07-20 14:31:12,619 - orka.utils.embedder - WARNING - Model files not found locally for sentence-transformers/all-MiniLM-L6-v2. May need to download.
2025-07-20 14:31:12,621 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-07-20 14:31:12,622 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: sentence-transformers/all-MiniLM-L6-v2
2025-07-20 14:31:15,381 - orka.utils.embedder - INFO - Successfully loaded embedding model: sentence-transformers/all-MiniLM-L6-v2 with dimension 384
2025-07-20 14:31:15,381 - orka.memory_logger - INFO - ✅ Embedder initialized for vector search
2025-07-20 14:31:15,382 - orka.memory.base_logger - INFO - Started automatic memory decay scheduler (interval: 30 minutes)
2025-07-20 14:31:15,386 - orka.utils.bootstrap_memory_index - INFO - Enhanced memory index 'orka_enhanced_memory' already exists
2025-07-20 14:31:15,386 - orka.memory.redisstack_logger - INFO - Enhanced HNSW memory index ready
2025-07-20 14:31:15,386 - orka.memory.redisstack_logger - INFO - RedisStack memory logger initialized with index: orka_enhanced_memory
2025-07-20 14:31:15,387 - orka.utils.bootstrap_memory_index - INFO - Enhanced memory index 'orka_enhanced_memory' already exists
2025-07-20 14:31:15,387 - orka.memory.redisstack_logger - INFO - Enhanced HNSW memory index ready
2025-07-20 14:31:15,387 - orka.memory_logger - INFO - ✅ RedisStack with HNSW and vector search enabled
{'id': 'test-routing-memory-writers', 'strategy': 'decision-tree', 'queue': 'orka:test-routing-memory', 'memory': {'enabled': True, 'backend': 'kafka', 'config': {'bootstrap_servers': 'localhost:9092', 'schema_registry_url': 'http://localhost:8081', 'use_schema_registry': True, 'topic_prefix': 'orka-memory', 'redis_url': 'redis://localhost:6380/0'}}, 'agents': ['memory_reader', 'binary_answer_classifier', 'memory_check_router']}
[{'id': 'memory_reader', 'type': 'memory', 'queue': 'orka:memory-reader', 'config': {'operation': 'read', 'memory_type': 'short_term', 'memory_category_filter': 'stored', 'limit': 5, 'enable_context_search': True, 'enable_temporal_ranking': True, 'temporal_weight': 0.1, 'similarity_threshold': 0.1}, 'namespace': 'processed_numbers', 'prompt': 'Number: {{ input }}'}, {'id': 'binary_answer_classifier', 'type': 'openai-binary', 'prompt': 'Can the previous memory provide a complete answer to this question?\n\nQUESTION: Is {{ input }} greater than 5?\nMEMORY: {{ previous_outputs.memory_reader.result.result.memories }}\n\nThe memory contains stored analysis results. If the memory shows analysis for this specific number {{ input }}, \nreturn true (memory can answer the question). If memory is empty ("NONE") or contains analysis for different numbers, \nreturn false (need to process this number).\n\nIMPORTANT: If you found actual memory entries (not "NONE"), that means we have a cached result and you should return TRUE.\nOnly return FALSE if the memory is "NONE" or empty.\n', 'queue': 'orka:classify'}, {'id': 'memory_check_router', 'type': 'router', 'params': {'decision_key': 'binary_answer_classifier', 'routing_map': {'false': ['binary_classifier', 'classification_router'], 'true': ['answer_returner']}}}, {'id': 'answer_returner', 'type': 'openai-answer', 'prompt': 'Based on previously stored analysis:\n{{ previous_outputs.memory_reader.result.result.memories }}\n\nReturn the cached result for input "{{ input }}" without reprocessing.\n'}, {'id': 'binary_classifier', 'type': 'openai-binary', 'prompt': 'Is the number in this input greater than 5? Return true or false: {{ input }}', 'queue': 'orka:classify'}, {'id': 'classification_router', 'type': 'router', 'params': {'decision_key': 'binary_classifier', 'routing_map': {'true': ['true_validation_guardian', 'true_memory_writer'], 'false': ['false_validation_guardian', 'false_memory_writer']}}}, {'id': 'true_validation_guardian', 'type': 'validate_and_structure', 'queue': 'orka:validation-guardian-true', 'prompt': 'Validate and structure the following number classification result for memory storage:\n\nQuestion: Is the number {{ input }} greater than 5?\nAnswer: Yes, {{ input }} IS greater than 5\nClassification Result: TRUE\nBinary Classifier Output: {{ previous_outputs.binary_classifier }}\n\nThis is a valid mathematical analysis. Please validate this result and structure it for memory storage.\n\nThe analysis shows that {{ input }} > 5, which makes the "greater than 5" condition TRUE.\n\nIMPORTANT: You MUST respond with the exact JSON format specified below. Do not use any other format.\n\nReturn your response in the following JSON format:\n{\n    "valid": true,\n    "reason": "The mathematical analysis is correct - {{ input }} is indeed > 5",\n    "memory_object": {\n        "number": "{{ input }}",\n        "result": "true",\n        "condition": "greater_than_5",\n        "analysis_type": "number_comparison",\n        "confidence": {{ previous_outputs.binary_classifier.confidence | default(1.0) }},\n        "category": "mathematical_analysis",\n        "validation_status": "validated",\n        "validation_reason": "Correct mathematical classification"\n    }\n}\n', 'depends_on': ['binary_classifier'], 'store_structure': '{\n  "number": "string",\n  "result": "string", \n  "condition": "string",\n  "analysis_type": "string",\n  "confidence": "number",\n  "category": "string",\n  "validation_status": "string",\n  "validation_reason": "string"\n}\n'}, {'id': 'false_validation_guardian', 'type': 'validate_and_structure', 'queue': 'orka:validation-guardian-false', 'prompt': 'Validate and structure the following number classification result for memory storage:\n\nQuestion: Is the number {{ input }} greater than 5?\nAnswer: No, {{ input }} is NOT greater than 5 (it is less than or equal to 5)\nClassification Result: FALSE\nBinary Classifier Output: {{ previous_outputs.binary_classifier }}\n\nThis is a valid mathematical analysis. Please validate this result and structure it for memory storage.\n\nThe analysis shows that {{ input }} â‰¤ 5, which makes the "greater than 5" condition FALSE.\n\nIMPORTANT: You MUST respond with the exact JSON format specified below. Do not use any other format.\n\nReturn your response in the following JSON format:\n{\n    "valid": true,\n    "reason": "The mathematical analysis is correct - {{ input }} is indeed â‰¤ 5",\n    "memory_object": {\n        "number": "{{ input }}",\n        "result": "false",\n        "condition": "less_than_or_equal_5",\n        "analysis_type": "number_comparison",\n        "confidence": {{ previous_outputs.binary_classifier.confidence | default(1.0) }},\n        "category": "mathematical_analysis",\n        "validation_status": "validated",\n        "validation_reason": "Correct mathematical classification"\n    }\n}\n', 'depends_on': ['binary_classifier'], 'store_structure': '{\n  "number": "string",\n  "result": "string",\n  "condition": "string", \n  "analysis_type": "string",\n  "confidence": "number",\n  "category": "string",\n  "validation_status": "string",\n  "validation_reason": "string"\n}\n'}, {'id': 'true_memory_writer', 'type': 'memory', 'queue': 'orka:memory-writer-short', 'config': {'operation': 'write', 'memory_type': 'short_term', 'vector': True}, 'namespace': 'processed_numbers', 'decay': {'enabled': True, 'default_long_term': False, 'short_term_hours': 0.025, 'long_term_hours': 0.05, 'check_interval_minutes': 0.5, 'importance_rules': {'base_score': 0.8, 'event_type_boosts': {'write': 0.3}}}, 'prompt': 'Number {{ input }} Analysis Result: {{ input }} > 5 (TRUE - greater than 5)\n\nClassification: {{ previous_outputs.binary_classifier.result }}\nConfidence: {{ previous_outputs.binary_classifier.confidence | default(1.0) }}\nValidation: {{ previous_outputs.true_validation_guardian.result.valid }}\n\nCACHED RESULT: The number {{ input }} IS greater than 5. Classification result is TRUE.\n', 'metadata': {'number': '{{ input }}', 'result': 'true', 'condition': 'greater_than_5', 'analysis_type': 'number_comparison', 'confidence': "{{ previous_outputs.binary_classifier.result.confidence | default('1.0') }}", 'category': 'mathematical_analysis', 'processed_by': 'binary_classifier', 'validated_by': 'true_validation_guardian', 'validation_status': '{{ previous_outputs.true_validation_guardian.result.valid }}', 'validation_reason': '{{ previous_outputs.true_validation_guardian.result.reason }}', 'validation_confidence': '{{ previous_outputs.true_validation_guardian.result.memory_object.confidence }}', 'structured_data': '{{ previous_outputs.true_validation_guardian.result.memory_object }}', 'timestamp': '{{ timestamp }}'}, 'key_template': 'validated_number_analysis_{{ input }}_gt5'}, {'id': 'false_memory_writer', 'type': 'memory', 'queue': 'orka:memory-writer-short', 'config': {'operation': 'write', 'memory_type': 'short_term', 'vector': True}, 'namespace': 'processed_numbers', 'decay': {'enabled': True, 'default_long_term': False, 'short_term_hours': 0.025, 'long_term_hours': 0.05, 'check_interval_minutes': 0.5, 'importance_rules': {'base_score': 0.8, 'event_type_boosts': {'write': 0.3}}}, 'prompt': 'Number {{ input }} Analysis Result: {{ input }} â‰¤ 5 (FALSE - not greater than 5)\n\nClassification: {{ previous_outputs.binary_classifier.result }}\nConfidence: {{ previous_outputs.binary_classifier.confidence | default(1.0) }}\nValidation: {{ previous_outputs.false_validation_guardian.result.valid }}\n\nCACHED RESULT: The number {{ input }} is NOT greater than 5. Classification result is FALSE.\n', 'metadata': {'number': '{{ input }}', 'result': 'false', 'condition': 'less_than_or_equal_5', 'analysis_type': 'number_comparison', 'confidence': "{{ previous_outputs.binary_classifier.result.confidence | default('1.0') }}", 'category': 'mathematical_analysis', 'processed_by': 'binary_classifier', 'validated_by': 'false_validation_guardian', 'validation_status': '{{ previous_outputs.false_validation_guardian.result.valid }}', 'validation_reason': '{{ previous_outputs.false_validation_guardian.result.reason }}', 'validation_confidence': '{{ previous_outputs.false_validation_guardian.result.memory_object.confidence }}', 'structured_data': '{{ previous_outputs.false_validation_guardian.result.memory_object }}', 'timestamp': '{{ timestamp }}'}, 'key_template': 'validated_number_analysis_{{ input }}_lte5'}]
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent memory_reader of type memory
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent binary_answer_classifier of type openai-binary
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent memory_check_router of type router
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent answer_returner of type openai-answer
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent binary_classifier of type openai-binary
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent classification_router of type router
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent true_validation_guardian of type validate_and_structure
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent false_validation_guardian of type validate_and_structure
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent true_memory_writer of type memory
2025-07-20 14:31:15.387058 > [ORKA][INIT] Instantiating agent false_memory_writer of type memory
2025-07-20 14:31:15.387058 > [ORKA] 1 >  Running agent 'memory_reader' of type 'memoryreadernode', payload: {"input": "127", "previous_outputs": {}}
2025-07-20 14:31:15,387 - orka.nodes.memory_reader_node - INFO - 🔍 SEARCHING: query='127', namespace='processed_numbers', log_type='memory'
2025-07-20 14:31:15,387 - orka.memory.redisstack_logger - DEBUG - In async context, using fallback encoding for embedding
2025-07-20 14:31:15,388 - orka.memory.redisstack_logger - DEBUG - Performing vector search for: 127
2025-07-20 14:31:15,390 - orka.memory.redisstack_logger - DEBUG - Created Redis connection for thread 26312
2025-07-20 14:31:15,391 - orka.memory.redisstack_logger - DEBUG - Vector search returned 0 results
2025-07-20 14:31:15,391 - orka.memory.redisstack_logger - DEBUG - Returning 0 filtered results
2025-07-20 14:31:15,391 - orka.nodes.memory_reader_node - INFO - 🔍 SEARCH RESULTS: Found 0 memories
2025-07-20 14:31:15,391 - orka.nodes.memory_reader_node - INFO - 🔍 FINAL RESULTS: 0 total memories, 0 stored memories after filtering
2025-07-20 14:31:15.393877 > [ORKA] 2 >  Running agent 'binary_answer_classifier' of type 'openaibinaryagent', payload: {"input": "127", "previous_outputs": {"memory_reader": {"memories": [], "query": "127", "backend": "redisstack", "search_type": "enhanced_vector", "num_results": 0}}}
2025-07-20 14:31:17,391 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-20 14:31:17.398239 > [ORKA] 3 >  Running agent 'memory_check_router' of type 'routernode', payload: {"input": "127", "previous_outputs": {"memory_reader": {"memories": [], "query": "127", "backend": "redisstack", "search_type": "enhanced_vector", "num_results": 0}, "binary_answer_classifier": {"response": false, "confidence": "0.95", "internal_reasoning": "The memory is empty, indicating no cached results for the input number 127.", "_metrics": {"tokens": 506, "prompt_tokens": 461, "completion_tokens": 45, "latency_ms": 1998.05, "cost_usd": 9.6e-05, "model": "gpt-4o-mini", "status_code": 200}, "formatted_prompt": ""}}}
2025-07-20 14:31:17.398239 > [ORKA] 3 > Agent 'memory_check_router' failed (attempt 1/3): unhashable type: 'dict'
2025-07-20 14:31:18.401405 > [ORKA] 3 > Agent 'memory_check_router' failed (attempt 2/3): unhashable type: 'dict'
2025-07-20 14:31:19.408668 > [ORKA] 3 > Agent 'memory_check_router' failed after 3 attempts: unhashable type: 'dict'
Error executing agent memory_check_router: unhashable type: 'dict'
[ORKA-WARNING] No suitable final agent found, returning full logs
2025-07-20 14:31:19,408 - orka.cli.core - INFO - Agent: memory_reader | Payload: {'input': '127', 'previous_outputs': {}, 'memories': [], 'query': '127', 'backend': 'redisstack', 'search_type': 'enhanced_vector', 'num_results': 0}
2025-07-20 14:31:19,409 - orka.cli.core - INFO - Agent: binary_answer_classifier | Payload: {'input': '127', 'previous_outputs': {'memory_reader': {'memories': [], 'query': '127', 'backend': 'redisstack', 'search_type': 'enhanced_vector', 'num_results': 0}}, 'response': False, 'confidence': '0.95', 'internal_reasoning': 'The memory is empty, indicating no cached results for the input number 127.', '_metrics': {'tokens': 506, 'prompt_tokens': 461, 'completion_tokens': 45, 'latency_ms': 1998.05, 'cost_usd': 9.6e-05, 'model': 'gpt-4o-mini', 'status_code': 200}, 'formatted_prompt': ''}