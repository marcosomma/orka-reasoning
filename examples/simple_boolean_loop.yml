# Simple Boolean Scoring Loop
# A minimal example showing boolean-based loop termination

orchestrator:
  id: simple-boolean-loop
  strategy: sequential
  agents:
    - quality_loop

agents:
  - id: quality_loop
    type: loop
    max_loops: 3
    score_threshold: 0.30  # Lowered from 0.85 to match actual performance with gpt-oss:20b
    
    # Boolean scoring - just specify the preset!
    scoring:
      preset: moderate  # Options: strict (0.90), moderate (0.85), lenient (0.80)
    
    internal_workflow:
      orchestrator:
        id: internal
        strategy: sequential
        agents: [analyzer, boolean_evaluator]
      
      agents:
        # Generate analysis
        - id: analyzer
          type: local_llm
          model: gpt-oss:20b
          model_url: http://localhost:11434/api/generate
          provider: ollama
          temperature: 0.7
          prompt: |
            Analyze: {{ get_input() }}
            
            {% if get_loop_number() > 1 %}
            Previous attempt had issues. Improve the analysis.
            {% endif %}
            
            Provide comprehensive insights.
        
        # Evaluate using boolean criteria
        - id: boolean_evaluator
          type: local_llm
          model: gpt-oss:20b
          model_url: http://localhost:11434/api/generate
          provider: ollama
          temperature: 0.1
          prompt: |
            Evaluate this analysis using boolean criteria:
            {{ get_agent_response('analyzer') }}
            
            Return JSON with true/false for each:
            
            {
              "completeness": {
                "has_all_required_steps": true,
                "addresses_all_query_aspects": false,
                "handles_edge_cases": true,
                "includes_fallback_path": false
              },
              "efficiency": {
                "minimizes_redundant_calls": true,
                "uses_appropriate_agents": true,
                "optimizes_cost": true,
                "optimizes_latency": false
              },
              "safety": {
                "validates_inputs": false,
                "handles_errors_gracefully": true,
                "has_timeout_protection": false,
                "avoids_risky_combinations": true
              },
              "coherence": {
                "logical_agent_sequence": true,
                "proper_data_flow": true,
                "no_conflicting_actions": true
              }
            }

# Usage Examples:
#
# 1. Run with default moderate preset (threshold: 0.85):
#    orka run simple_boolean_loop.yml "Analyze user authentication flow"
#
# 2. Switch to strict preset (threshold: 0.90) by editing line 18:
#    scoring:
#      preset: strict
#
# 3. Add custom weights to emphasize specific criteria:
#    scoring:
#      preset: moderate
#      custom_weights:
#        safety.validates_inputs: 0.20  # Increase from default
#        completeness.has_all_required_steps: 0.25
#
# 4. View detailed scoring breakdown in trace logs:
#    - boolean_evaluations: Shows all true/false values
#    - dimension_scores: Shows score per dimension (completeness, efficiency, etc.)
#    - passed_criteria: List of criteria that passed
#    - failed_criteria: List of criteria that failed

